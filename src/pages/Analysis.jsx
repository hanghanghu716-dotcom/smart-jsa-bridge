import React, { useState, useRef, useEffect } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';

// ----------------------------------------------------------------------
// [내장 DB] 안전보건공단 표준 작업 안전수칙 데이터베이스
// ----------------------------------------------------------------------
const RISK_DATABASE = [
  {
    keywords: ["철근", "배근", "가공", "결속", "절단기"],
    risks: [
      { factor: "철근 절단기 사용 중 손가락 협착 및 절단", measure: "반복 조작 금지 및 전용 밀대 사용" },
      { factor: "철근 운반 중 전도 및 발등 타격", measure: "안전화 착용 및 인력 운반 시 2인 1조 이행" },
      { factor: "결속선 작업 중 눈 찔림", measure: "보안경 착용 및 결속선 끝단 하향 처리" },
      { factor: "철근 인양 중 다발 해체로 인한 낙하", measure: "2줄 걸이 준수 및 인양 전 결속 상태 확인" },
      { factor: "고소 배근 작업 중 추락", measure: "안전대 체결 및 작업 발판 확보" },
      { factor: "적재된 철근에 걸려 넘어짐", measure: "자재 정리정돈 및 통로 확보" },
      { factor: "철근 절단 파편 비래", measure: "절단기 방호 커버 설치 및 보안경 착용" },
      { factor: "수직 철근 상단 돌출부에 의한 찔림", measure: "철근 캡 설치 및 주의 표지 부착" },
      { factor: "철근 가공기 누전 감전", measure: "외함 접지 및 누전 차단기 점검" },
      { factor: "장시간 쪼그려 작업으로 인한 근골격계 질환", measure: "정기적 스트레칭 및 작업대 높이 조절" }
    ]
  },
  {
    keywords: ["거푸집", "유로폼", "알폼", "해체", "탈형"],
    risks: [
      { factor: "거푸집 해체 시 부재 낙하에 의한 타격", measure: "작업 하부 출입 통제 및 해체 순서 준수" },
      { factor: "거푸집 인양 중 슬링벨트 파단", measure: "줄걸이 용구 사전 점검 및 정격 하중 준수" },
      { factor: "고소 거푸집 설치 중 단부 추락", measure: "안전 난간 설치 및 안전대 고리 체결" },
      { factor: "폼타이 및 핀 돌출부에 의한 긁힘", measure: "돌출 부위 제거 및 보호 장갑 착용" },
      { factor: "거푸집 전도(넘어짐)", measure: "안전 지지대(Support) 확실한 고정" },
      { factor: "해체 작업 중 무너짐", measure: "임의 해체 금지 및 관리감독자 배치" },
      { factor: "거푸집 운반 중 요통 발생", measure: "중량물 취급 주의 교육 및 대차 활용" },
      { factor: "강풍 시 거푸집 양중 중 충돌", measure: "강풍 시 양중 중지 가이드라인 준수" },
      { factor: "거푸집 오일(박리제)에 의한 미끄러짐", measure: "박리제 도포 구역 즉시 청소 및 주의" },
      { factor: "해체된 폼의 못 찔림", measure: "못 제거 작업 병행 및 안전화 착용 확인" }
    ]
  },
  {
    keywords: ["콘크리트", "타설", "펌프카", "바이브레이터", "타설공"],
    risks: [
      { factor: "펌프카 아웃트리거 지반 침하로 전도", measure: "지반 다짐 및 침목(받침판) 사용 필수" },
      { factor: "압송관(호스) 요동에 의한 타격", measure: "호스 끝단 2인 이상 유지 및 고정줄 체결" },
      { factor: "바이브레이터 사용 중 전격 감전", measure: "이동식 분전함 사용 및 절연 장갑 착용" },
      { factor: "타설 중 거푸집 터짐(측압)", measure: "타설 속도 준수 및 거푸집 상태 상시 모니터링" },
      { factor: "콘크리트 액 미산에 의한 피부염/안질환", measure: "보안경 및 방수용 보호 장갑 착용" },
      { factor: "철근 배근 위 이동 중 발 빠짐", measure: "안전 통로(발판) 설치 및 이동" },
      { factor: "야간 타설 중 조도 부족으로 인한 전도", measure: "충분한 투광등 배치 및 이동로 조명 확보" },
      { factor: "펌프카 붐대 인근 고압선 접촉", measure: "이격 거리 준수 및 감시인 배치" },
      { factor: "콘크리트 잔재 제거 중 기계 협착", measure: "청소 시 전원 차단 및 LOTO 실시" },
      { factor: "장시간 중량물 호스 조작으로 인한 근육통", measure: "교대 근무 실시 및 휴식 시간 부여" }
    ]
  },
  {
    keywords: ["조적", "벽돌", "블록", "쌓기", "비계"],
    risks: [
      { factor: "벽돌 벽체 무너짐", measure: "일일 쌓기 높이 준수(1.2~1.5m) 및 보강재 설치" },
      { factor: "벽돌 운반용 리프트 탑승 중 사고", measure: "인원 탑승 엄금 및 과적 방지" },
      { factor: "고소 쌓기 작업 중 추락", measure: "말비계 작업 시 난간 설치 및 안전모 착용" },
      { factor: "벽돌 낙하에 의한 하부 작업자 타격", measure: "작업 하부 경계 구역 설정 및 낙하물 방지망" },
      { factor: "시멘트 모르타르에 의한 피부 부식", measure: "불침투성 보호구 착용 및 세척 시설 확보" },
      { factor: "중량물(벽돌) 반복 취급에 의한 요통", measure: "2인 1조 작업 및 기계식 운반 권장" },
      { factor: "조적용 믹서기 협착", measure: "믹서기 가동 중 손 삽입 금지 덮개 설치" },
      { factor: "작업 발판 과적재로 인한 붕괴", measure: "자재 분산 적재 및 하중 한도 준수" },
      { factor: "어두운 장소 작업 중 돌출물 충돌", measure: "작업 구역 내 충분한 조도 확보" },
      { factor: "가공 시 분진 흡입", measure: "절단 시 습식 작업 또는 방진마스크 착용" }
    ]
  },
  {
    keywords: ["미장", "방수", "견출", "우레탄", "에폭시"],
    risks: [
      { factor: "방수재 유기용제 증기 중독", measure: "송풍기 가동 및 방독마스크 착용" },
      { factor: "밀폐구역 방수 중 화재 및 폭발", measure: "화기 엄금 및 방폭형 장비 사용" },
      { factor: "벽면 견출 작업 중 추락", measure: "달비계/고소작업대 안전 점검 및 안전대 체결" },
      { factor: "방수액 피부 접촉에 의한 화학 화상", measure: "보호 장갑, 보호의 및 고글 착용" },
      { factor: "바닥 에폭시 작업 중 미끄러짐", measure: "전용 안전화 착용 및 작업 순서 준수" },
      { factor: "고속 믹서기 날에 의한 부상", measure: "저속 교반기 사용 및 작업복 밀착" },
      { factor: "현장 내 자재 방치로 인한 화재", measure: "인화성 물질 별도 보관함 관리" },
      { factor: "분무기(스프레이) 고압 노출", measure: "분사구 방향 주의 및 압력 밸브 점검" },
      { factor: "중량 자재(드럼) 운반 중 협착", measure: "운반 대차 사용 및 손 끼임 주의" },
      { factor: "지하 작업 시 산소 결핍", measure: "작업 전 가스 농도 측정 필수" }
    ]
  },
  {
    keywords: ["석재", "타일", "대리석", "본드", "절단"],
    risks: [
      { factor: "석재 절단기 칼날에 의한 절단", measure: "날 덮개 설치 및 고정 상태 점검" },
      { factor: "대형 석재 운반 중 전도 및 협착", measure: "진공 흡착기 사용 또는 2인 이상 운반" },
      { factor: "석재 낙하에 의한 발등 골절", measure: "안전화 착용 및 수직 적재 금지" },
      { factor: "타일 부착용 본드 중독", measure: "작업장 환기 및 방독마스크 착용" },
      { factor: "절단 시 파편 비래로 인한 안구 부상", measure: "보안경 및 안면 보호구 착용" },
      { factor: "고소 외벽 석재 작업 중 추락", measure: "수직 보호망 설치 및 생명줄 체결" },
      { factor: "석재 가공 분진 흡입", measure: "방진마스크 착용 및 집진기 가동" },
      { factor: "작업대 붕괴로 인한 사고", measure: "작업대 구조 검토 및 최대 하중 준수" },
      { factor: "핸드 그라인더 반동(Kick-back) 사고", measure: "그라인더 파지법 숙달 및 방호 커버 유지" },
      { factor: "바닥 타일 작업 중 무릎 관절 손상", measure: "무릎 보호대 착용 및 적정 휴식" }
    ]
  },
  {
    keywords: ["목공", "목재", "합판", "원형톱", "타카"],
    risks: [
      { factor: "원형톱 칼날에 의한 손가락 절단", measure: "톱날 덮개 및 반동 방지 기구 설치" },
      { factor: "타카 오발에 의한 박힘 사고", measure: "방향 주의 및 안전 장치 임의 해체 금지" },
      { factor: "목재 가시 찔림 및 베임", measure: "가죽 장갑 착용 및 목재 표면 확인" },
      { factor: "목분(나무 먼지)에 의한 호흡기 질환", measure: "집진 장치 가동 및 방진마스크 착용" },
      { factor: "목재 적재물 무너짐", measure: "평탄 지반 적재 및 높이 제한(1.5m 이하)" },
      { factor: "고소 천장 목공 작업 중 추락", measure: "안전 난간 부착 우마 사용 및 안전모 착용" },
      { factor: "전동 공구 코드선 누전", measure: "피복 상태 점검 및 2중 절연 공구 사용" },
      { factor: "목재 가공 중 발생한 소음 장해", measure: "귀마개 등 청력 보호구 착용" },
      { factor: "작업장 내 목재 부스러기로 인한 화재", measure: "작업 후 즉시 청소 및 인화물 제거" },
      { factor: "목재 운반 중 인적 충돌", measure: "운반로 확보 및 주변 작업자 확인" }
    ]
  },
  {
    keywords: ["유리", "창호", "프레임", "흡착기", "실란트"],
    risks: [
      { factor: "유리 파손에 의한 베임 및 찔림", measure: "보호 장갑(방검) 착용 및 파손 유리 즉시 처리" },
      { factor: "대형 유리 운반 중 전도 협착", measure: "전용 진공 흡착기 점검 및 유도원 배치" },
      { factor: "고소 유리 끼우기 중 추락", measure: "안전대 체결 및 개구부 방호 조치" },
      { factor: "윈치/호이스트 인양 중 유리 낙하", measure: "인양 슬링 점검 및 하부 통제" },
      { factor: "창호 프레임 용접 중 화재", measure: "불티 방지포 설치 및 화기 감시인 배치" },
      { factor: "실란트 시공 시 피부염", measure: "보호 장갑 착용 및 위생 관리" },
      { factor: "유리 세척제(화학물질) 증기 흡입", measure: "방독마스크 착용 및 환기" },
      { factor: "유리 적재대(A-Frame) 전도", measure: "지반 수평 유지 및 고정 체인 설치" },
      { factor: "창틀 설치 중 손가락 협착", measure: "지렛대 사용 시 손 위치 주의" },
      { factor: "유리 양중 중 강풍에 의한 흔들림", measure: "풍속 확인 및 강풍 시 작업 중단" }
    ]
  },
  {
    keywords: ["덕트", "공조", "보온", "함석", "그라스울"],
    risks: [
      { factor: "덕트 날카로운 단면에 베임", measure: "방검 장갑 착용 및 단부 보호 조치" },
      { factor: "고소 덕트 설치 중 추락", measure: "이동식 비계 안전 난간 준수 및 안전대 체결" },
      { factor: "보온재(그라스울) 비산에 의한 피부 자극", measure: "긴소매 보호의 및 방진마스크 착용" },
      { factor: "덕트 인양 중 줄걸이 이탈", measure: "인양 지점 무게 중심 확인 및 고정" },
      { factor: "천장 내부 작업 중 질식", measure: "환기 시설 가동 및 산소 농도 측정" },
      { factor: "덕트 가공 전동 가위 사용 중 협착", measure: "안전 장구 착용 및 손 이격 거리 유지" },
      { factor: "중량 덕트 운반 중 요통", measure: "2인 1조 작업 및 기계식 운반구 활용" },
      { factor: "덕트 고정 볼트 낙하", measure: "공구 주머니 사용 및 하부 작업 통제" },
      { factor: "보온 작업용 접착제 화재", measure: "작업장 내 인화물 제거 및 소화기 비치" },
      { factor: "덕트 선단부에 눈 찔림", measure: "보안경 착용 및 단부 안전 표식" }
    ]
  },
  {
    keywords: ["배관", "용접", "나사절삭기", "플랜지", "수압시험"],
    risks: [
      { factor: "나사 절삭기 회전부 말림(협착)", measure: "장갑 미착용 작업 금지 및 회전부 접근 주의" },
      { factor: "수압/기압 시험 중 배관 파열", measure: "시험 압력 준수 및 비산 방지 조치" },
      { factor: "배관 용접 불티에 의한 화재", measure: "가연물 제거 및 화기 작업 허가제 운영" },
      { factor: "배관 인양 중 흔들림 충돌", measure: "유도 로프 사용 및 인입 지점 통제" },
      { factor: "고소 배관 용접 중 추락", measure: "고소작업대(시설) 이용 및 안전대 착용" },
      { factor: "밀폐 공간 배관 작업 중 질식", measure: "송풍기 가동 및 가스 농도 측정" },
      { factor: "배관 절단 시 금속 파편 비래", measure: "보안경 및 안면 보호구 착용" },
      { factor: "플랜지 체결 중 손가락 협착", measure: "체결 공구 사용 및 손 위치 주의" },
      { factor: "배관 내 잔류수 누출로 인한 미끄러짐", measure: "잔류수 제거 작업 선행 및 바닥 청소" },
      { factor: "중량 배관 인력 운반 중 요통", measure: "체인 블록 등 양중기 활용" }
    ]
  },
  {
    keywords: ["도장", "페인트", "스프레이", "시너", "뿜칠"],
    risks: [
      { factor: "유기용제(시너) 증기 흡입 중독", measure: "방독마스크 착용 및 환기 설비 가동" },
      { factor: "페인트 스프레이 화재 및 폭발", measure: "정전기 제거 및 방폭 장비 사용" },
      { factor: "고소 도장 작업 중 추락", measure: "안전 난간 설치 발판 및 안전대 체결" },
      { factor: "시너 피부 노출에 의한 피부염", measure: "내화학 장갑 및 보호의 착용" },
      { factor: "뿜칠 분진에 의한 호흡기 장해", measure: "특급 방진/방독마스크 혼합 착용" },
      { factor: "고압 스프레이 건 노즐 사고", measure: "신체에 직접 분사 금지 및 압력 해제 확인" },
      { factor: "도료 보관소 화재", measure: "전용 보관소 지정 및 소화 설비 비치" },
      { factor: "작업 중 유해물질 눈 비산", measure: "보안경 또는 고글 상시 착용" },
      { factor: "밀폐공간 도장 중 산소결핍/중독", measure: "작업 전 측정 및 외부 감시인 배치" },
      { factor: "폐페인트 방치로 인한 환경 오염/화재", measure: "지정 폐기물 처리 절차 준수" }
    ]
  },

  {
    keywords: ["철거", "파쇄", "브레이커", "압쇄기", "구조물해체"],
    risks: [
      { factor: "구조물 해체 중 예기치 못한 붕괴", measure: "해체 순서 준수 및 구조 검토 선행" },
      { factor: "파쇄 파편 비래에 의한 타격", measure: "비산 방지망 설치 및 보호구 착용" },
      { factor: "고소 철거 작업 중 추락", measure: "고소작업대 활용 및 안전대 생명줄 체결" },
      { factor: "철거 장비(백호) 전도", measure: "작업로 평탄성 확보 및 장비 하중 분산" },
      { factor: "해체 시 발생하는 고농도 분진 흡입", measure: "지속적 살수 실시 및 방진마스크 착용" },
      { factor: "가스 절단 중 잔류 인화물 폭발", measure: "배관 내 잔류물 제거 및 화기 허가제" },
      { factor: "석면 함유 자재 무단 해체", measure: "사전 조 조사 이행 및 전문 업체 위탁" },
      { factor: "지하층 해체 시 장비 하중으로 인한 슬래브 붕괴", measure: "하부 잭서포트 보강 설치" },
      { factor: "낙하물 방지 시설 미비로 인한 주변 통행인 사고", measure: "낙하물 방지망 및 가설 울타리 강화" },
      { factor: "소음 및 진동에 의한 민원 및 건강 장해", measure: "방음벽 설치 및 작업 시간 준수" }
    ]
  },
  {
    keywords: ["도로포장", "아스콘", "피니셔", "롤러", "스키드로더"],
    risks: [
      { factor: "포장 장비와 작업자 간 충돌", measure: "전담 신호수 배치 및 장비 접근 금지구역 설정" },
      { factor: "고온 아스콘 접촉에 의한 화상", measure: "내열 안전화 및 보호 장갑 착용" },
      { factor: "롤러 장비 전도", measure: "노견 끝단 작업 시 주의 및 지반 견고성 확인" },
      { factor: "아스콘 흄(연기) 장기 노출", measure: "바람을 등지고 작업 및 마스크 착용" },
      { factor: "유제 분무 중 인화 화재", measure: "작업 구역 내 흡연 금지 및 소화기 비치" },
      { factor: "도로 차단 불량으로 인한 일반 차량 돌입", measure: "교통 통제 표지판 및 싸인카 배치" },
      { factor: "스키드로더 회전 시 협착", measure: "회전 반경 내 출입 통제 및 버킷 하강 주차" },
      { factor: "야간 포장 작업 중 시거 미확보", measure: "투광등 설치 및 고휘도 안전조끼 착용" },
      { factor: "장비 점검 중 유압 가동에 의한 협착", measure: "점검 시 엔진 정지 및 락핀 체결" },
      { factor: "포장면 단차에 의한 작업자 전도", measure: "작업 통로 평탄성 유지 및 주의 표지" }
    ]
  },
  {
    keywords: ["승강기", "엘리베이터", "가이드레일", "권상기", "피트"],
    risks: [
      { factor: "승강기 피트 내부로 추락", measure: "출입문 개구부 방호조치 및 안전대 체결" },
      { factor: "카 상부 작업 중 천장부 협착", measure: "작업 모드(수동) 전환 및 비상정지장치 확인" },
      { factor: "가이드레일 양중 중 낙하", measure: "윈치 브레이크 점검 및 하부 통제" },
      { factor: "권상기 전원 부위 감전", measure: "LOTO 이행 및 검전기 활용" },
      { factor: "피트 내 오폐수 및 가스에 의한 질식", measure: "작업 전 환기 및 산소 농도 측정" },
      { factor: "카 이동 중 균형추(Counter Weight)와 충돌", measure: "운행 구간 격리 및 안전 거리 확보" },
      { factor: "용접 작업 중 가이드레일 기름에 화재", measure: "주변 유류 제거 및 방화포 설치" },
      { factor: "중량물(카 프레임) 거치 중 손가락 협착", measure: "수공구 사용 및 2인 1조 수신호" },
      { factor: "승강기 시운전 중 오작동", measure: "제어반 점검 완료 후 시운전 및 무전기 소통" },
      { factor: "좁은 통로 자재 운반 중 부상", measure: "중량물 운반 가이드 준수" }
    ]
  },
  {
    keywords: ["조경", "나무", "식재", "굴착기", "전정"],
    risks: [
      { factor: "수목 인양 중 슬링벨트 이탈", measure: "무게 중심 확인 및 전용 줄걸이 사용" },
      { factor: "전정 작업 중 사다리 전도", measure: "2인 1조 작업 및 사다리 하부 고정" },
      { factor: "기계톱(엔진톱) 사용 중 신체 베임", measure: "전용 방검복 착용 및 톱날 덮개 확인" },
      { factor: "고압선 인근 수목 식재 중 감전", measure: "절연봉 사용 및 선로 이격 거리 준수" },
      { factor: "굴착기 작업 반경 내 작업자 충돌", measure: "유도원 배치 및 장비 후방 센서 점검" },
      { factor: "농약 살포 중 약제 중독", measure: "방독마스크 및 보호의 착용, 풍향 확인" },
      { factor: "경사면 작업 중 미끄러짐", measure: "미끄럼 방지 장화 착용 및 안전 통로 확보" },
      { factor: "중량 수목 이동 중 전도", measure: "인력 이동 금지 및 양중 장비 활용" },
      { factor: "야외 작업 중 온열 질환 및 해충", measure: "충분한 수분 섭취 및 기피제 사용" },
      { factor: "돌 쌓기(석축) 작업 중 무너짐", measure: "하단 기초 견고성 확인 및 적재 높이 준수" }
    ]
  },
  {
    keywords: ["석면", "텍스", "밤라이트", "음압기", "밀폐제거"],
    risks: [
      { factor: "석면 가루 흡입으로 인한 진폐증", measure: "전면형 방진마스크 및 보호의 착용" },
      { factor: "음압 유지 실패로 인한 석면 외부 유출", measure: "음압 기록계 상시 모니터링 및 밀폐 강화" },
      { factor: "고소 천장재 해체 중 추락", measure: "이동식 비계 안전 난간 및 안전대 체결" },
      { factor: "습윤제 도포 미비로 인한 분진 비산", measure: "해체 전·중 지속적인 습윤 상태 유지" },
      { factor: "위생설비(탈의실) 미통과로 인한 교차 오염", measure: "정해진 세척 절차 준수 필수" },
      { factor: "전선 절단 시 감전", measure: "전원 차단 확인 및 비전도성 도구 사용" },
      { factor: "석면 폐기물 봉투 파손", measure: "이중 밀봉 포장 및 날카로운 자재 분리" },
      { factor: "밀폐 공간 내 고온에 의한 온열질환", measure: "충분한 휴식 및 공기 순환 설비 보강" },
      { factor: "해체 도구(헤라 등)에 베임", measure: "보호 장갑 착용 및 도구 관리" },
      { factor: "작업장 내 통신 두절", measure: "외부 감시인과 통신 장비 운영" }
    ]
  },
  {
    keywords: ["조명", "기구", "스위치", "등기구", "점검"],
    risks: [
      { factor: "사다리 위 조명 취부 중 전도", measure: "사다리 최상단 작업 금지 및 2인 1조" },
      { factor: "활선 상태 기구 연결 중 감전", measure: "차단기 Off 상태 확인 및 절연 장갑" },
      { factor: "천장재 파손에 의한 추락", measure: "천장 내부 트러스 지지 확인" },
      { factor: "등기구 낙하에 의한 하부 타격", measure: "기구 고정 철저 및 하부 통제" },
      { factor: "전선 피복 손상부 접촉", measure: "배선 정리 및 단자대 절연 처리" },
      { factor: "천장 속 날카로운 엠바에 베임", measure: "작업 장갑 착용 및 시야 확보" },
      { factor: "안정기 폭발 및 화재", measure: "정격 용량 부품 사용 및 배선 점검" },
      { factor: "공구(드라이버 등) 낙하", measure: "공구 손목 스트랩 사용" },
      { factor: "어두운 현장에서 이동 중 충돌", measure: "이동식 작업등 비치" },
      { factor: "장시간 고개 젖힘 작업으로 인한 거북목/통증", measure: "정기적 스트레칭 및 작업대 높이 조절" }
    ]
  },

  {
    keywords: ["지게차", "상하차", "포크", "파레트", "적재"],
    risks: [
      { factor: "지게차 이동 중 보행자와 충돌", measure: "전용 통로 구분 및 후진 경보기/경광등 작동" },
      { factor: "과다 적재로 인한 시야 미확보 및 전도", measure: "허용 하중 준수 및 시야 확보 불능 시 유도원 배치" },
      { factor: "포크 위 작업자 탑승 중 추락", measure: "지게차를 고소작업대로 사용하는 행위 엄금" },
      { factor: "급선회 시 원심력에 의한 장비 전도", measure: "구내 제한 속도 준수 및 급제동 금지" },
      { factor: "포크 사이 손/발 끼임(협착)", measure: "팔레트 조정 시 엔진 정지 및 수동 조작 금지" },
      { factor: "경사로 주행 중 화물 낙하", measure: "경사로 주행 시 화물을 위쪽으로 향하게 운전" },
      { factor: "정비 중 마스트 하강에 의한 협착", measure: "안전 블록 또는 지지대 설치 후 정비" },
      { factor: "불안정한 적재로 인한 화물 무너짐", measure: "편하중 금지 및 필요 시 결속선 체결" },
      { factor: "시동을 켠 채 운전석 이탈", measure: "운전석 이탈 시 포크 바닥 하강 및 주차 브레이크 체결" },
      { factor: "작업장 조명 부족으로 인한 충돌", measure: "야간 작업 시 충분한 투광기 및 헤드라이트 확보" }
    ]
  },
  {
    keywords: ["항타기", "항발기", "천공", "말뚝", "파일인양"],
    risks: [
      { factor: "와이어로프 마모로 인한 파일 낙하", measure: "와이어로프 10% 이상 마모 시 즉시 교체" },
      { factor: "장비 선회 중 주변 구조물 충돌", measure: "선회 반경 내 출입 금지 및 전담 신호수 배치" },
      { factor: "지반 지지력 부족으로 인한 장비 전도", measure: "철판 포설 및 지반 다짐 상태 수시 점검" },
      { factor: "파일 연결 용접 중 화재", measure: "용접 불티 방지포 설치 및 화재 감시인 상주" },
      { factor: "권과방지장치 해제로 인한 추락", measure: "안전장치 임의 해체 금지 및 작동 시험" },
      { factor: "리더 상부 작업 중 추락", measure: "안전대 체결 및 생명줄 고정" },
      { factor: "캡핑 작업 중 손가락 협착", measure: "수신호 일치 확인 및 인력 직접 접촉 최소화" },
      { factor: "유압 호스 파열로 인한 작동유 비산", measure: "노후 유압 호스 사전 교체 및 점검" },
      { factor: "파일 인양 중 무게중심 이탈", measure: "전용 달기구 사용 및 수평 유지 확인" },
      { factor: "고압 전선 인접 작업 중 전격", measure: "방호벽 설치 및 감시인 배치" }
    ]
  },
  {
    keywords: ["가설펜스", "울타리", "EGI휀스", "가설재", "비계"],
    risks: [
      { factor: "강풍에 의한 펜스 전도", measure: "지주 파이프 매설 깊이 준수 및 버팀대 보강" },
      { factor: "날카로운 펜스 단면에 베임", measure: "말단부 보호 캡 설치 및 방검 장갑 착용" },
      { factor: "볼트 체결 중 고소 추락", measure: "이동식 비계 사용 및 안전 난간 준수" },
      { factor: "기존 매설물 파손(펜스 기초 굴착 시)", measure: "작업 전 매설물 탐지 및 도면 확인" },
      { factor: "자재 상하차 중 협착", measure: "양중 장비 사용 및 손 끼임 주의" },
      { factor: "펜스 상부 작업 중 떨어짐", measure: "안전모 턱끈 체결 및 작업 발판 확보" },
      { factor: "전동 공구 누전 감전", measure: "야외 작업 시 외함 접지 및 누전 차단기 점검" },
      { factor: "도로변 작업 중 차량 충돌", measure: "싸인카 배치 및 통제 유도원 운용" },
      { factor: "자재 적재 중 무너짐", measure: "자재 높이 제한 및 평탄 지반 적재" },
      { factor: "용접 부위 부식으로 인한 파손", measure: "용접부 방청 도장 및 결속 상태 점검" }
    ]
  },
  {
    keywords: ["복공판", "복공", "가설도로", "H빔", "볼트체결"],
    risks: [
      { factor: "복공판 틈새 발 빠짐 및 전도", measure: "틈새 간격 최소화 및 미끄럼 방지 처리" },
      { factor: "복공판 양중 중 낙하", measure: "4줄 걸이 양중 및 샤클 체결 상태 확인" },
      { factor: "H빔 거치 중 협착", measure: "지렛대 사용 및 손 위치 주의" },
      { factor: "복공 하부 작업 중 낙하물 타격", measure: "하부 작업 구역 격리 및 안전망 설치" },
      { factor: "볼트 조임 중 추락", measure: "H빔 상부 이동 시 생명줄 및 안전대 사용" },
      { factor: "복공판 미끄러짐으로 차량 사고", measure: "표면 거칠기 확보 및 우천 시 서행 표지" },
      { factor: "하부 용접 작업 중 가스 체류", measure: "지속 환기 및 가스 농도 측정" },
      { factor: "산소 절단 작업 중 화재", measure: "하부 가연물 제거 및 소화기 비치" },
      { factor: "복공판 단차에 의한 걸림", measure: "수평 레벨 유지 및 연결핀 고정" },
      { factor: "하부 지지물 붕괴", measure: "지지 구조물 볼트 조임 상태 정기 점검" }
    ]
  },
  {
    keywords: ["금형", "사출", "프레스", "교체", "세팅"],
    risks: [
      { factor: "금형 인양 중 줄걸이 파단", measure: "금형 중량 확인 및 전용 아이볼트 점검" },
      { factor: "슬라이드 하강으로 인한 협착", measure: "안전 블록 설치 및 안전 센서 작동 확인" },
      { factor: "금형 세팅 중 불시 가동", measure: "LOTO(잠금장치 및 표지판) 철저 이행" },
      { factor: "고온 금형 접촉 화상", measure: "내열 장갑 착용 및 냉각 확인" },
      { factor: "냉각수 누출로 인한 미끄러짐", measure: "연결 호스 점검 및 바닥 수분 제거" },
      { factor: "금형 체결 볼트 파손", measure: "정격 토크 준수 및 규격 볼트 사용" },
      { factor: "중량물 수동 조작 중 요통", measure: "호이스트 활용 및 2인 1조 작업" },
      { factor: "금형 내부 이물질 제거 중 손가락 부상", measure: "전용 수공구 사용 및 전원 차단" },
      { factor: "주변 배선 노출로 인한 감전", measure: "배선 정리 및 단자대 덮개 설치" },
      { factor: "작업 공간 협소로 인한 충돌", measure: "자재 정리정돈 및 통로 확보" }
    ]
  },
  {
    keywords: ["케이블트레이", "전선관", "레이스웨이", "입선", "배선"],
    risks: [
      { factor: "고소 트레이 설치 중 추락", measure: "고소작업대 탑승 및 난간 체결" },
      { factor: "트레이 단부 날카로운 부위에 베임", measure: "방검 장갑 착용 및 마감재 설치" },
      { factor: "전선 견인 중 손가락 협착", measure: "견인기(윈치) 사용 시 수신호 준수" },
      { factor: "입선 작업 중 케이블 피복 손상", measure: "풀링 윤활제 사용 및 날카로운 부분 보강" },
      { factor: "상부 자재 낙하로 하부 타격", measure: "하부 통제 및 공구 낙하 방지 끈" },
      { factor: "전동 공구 사용 중 감전", measure: "차단기 점검 및 피복 상태 확인" },
      { factor: "사다리 작업 중 전도", measure: "최상단 작업 금지 및 하부 조력자" },
      { factor: "케이블 하중에 의한 트레이 붕괴", measure: "지지대(Saddle) 간격 준수 및 보강" },
      { factor: "밀폐된 천장 내부 질식", measure: "작업 전 환기 및 산소 측정" },
      { factor: "작업 중 화재 발생(용접/절단 시)", measure: "불티 방지포 및 소화기 비치" }
    ]
  },
  {
    keywords: ["수전", "시운전", "배전반", "검전", "절연시험"],
    risks: [
      { factor: "특고압 충전부 근접 감전(아크)", measure: "절연 보호구 착용 및 안전 이격 거리 확보" },
      { factor: "오조작에 의한 전원 투입", measure: "LOTO 실시 및 조작 금지 표지 부착" },
      { factor: "절연 저항 측정 중 감전", measure: "측정 전 잔류 전하 방전 조치" },
      { factor: "배선 단락에 의한 폭발 및 화상", measure: "아크 방호복 착용 및 체결 상태 점검" },
      { factor: "변압기 과열 및 화재", measure: "온도 상시 모니터링 및 냉각 설비 점검" },
      { factor: "시운전 중 기계 오작동에 의한 충돌", measure: "비상 정지 버튼 위치 확인 및 유도원 배치" },
      { factor: "습기 유입에 의한 지락 사고", measure: "제어반 내부 습기 제거 및 밀폐 확인" },
      { factor: "공구 오사용으로 인한 단락", measure: "절연 처리된 전용 공구 사용" },
      { factor: "고압 가스(SF6) 누출 및 질식", measure: "가스 누출 감지기 운용 및 환기" },
      { factor: "검전기 미사용으로 인한 충전 확인 불가", measure: "작업 전 검전기를 통한 무전압 상태 확인" }
    ]
  },
  {
    keywords: ["보일러", "냉동기", "압력용기", "배관", "설치"],
    risks: [
      { factor: "중량 기계 반입 중 협착", measure: "중량물 취급 계획서 작성 및 전용 롤러 사용" },
      { factor: "고압 시험 중 파열", measure: "단계별 승압 및 위험 구역 격리" },
      { factor: "용접 불티에 의한 우레탄 보온재 화재", measure: "방화포 설치 및 화기 감시인 배치" },
      { factor: "기계 기초 베이스 추락", measure: "개구부 덮개 설치 및 단부 접근 금지" },
      { factor: "냉매 누출로 인한 질식/중독", measure: "냉매 감지기 및 송기 마스크 비치" },
      { factor: "기계 연결부 나사산 파손", measure: "정격 토크 및 전용 공구 사용" },
      { factor: "전동기 결선 중 감전", measure: "LOTO 준수 및 검전" },
      { factor: "기계실 내 좁은 통로 전도", measure: "자재 적치 금지 및 조명 확보" },
      { factor: "윈치 양중 중 와이어 단선", measure: "중량 한도 초과 금지 및 와이어 점검" },
      { factor: "시동 중 회전체 협착", measure: "커플링 가드 설치 및 접근 금지" }
    ]
  },
  {
    keywords: ["조경", "석축", "돌쌓기", "축조", "메쌓기"],
    risks: [
      { factor: "석재 낙하에 의한 하부 작업자 매몰", measure: "상하 동시 작업 금지 및 경계 구역 설정" },
      { factor: "인양 중 돌 이탈", measure: "전용 집게 또는 슬링 벨트 2점 지지 확인" },
      { factor: "석재 가공 중 파편 비래", measure: "보안경 및 방진 마스크 착용" },
      { factor: "기초 지반 부실로 인한 석축 붕괴", measure: "지반 다짐 및 배수층 확보" },
      { factor: "굴착기 버킷 접촉", measure: "장비 작업 반경 내 진입 금지 및 신호수 배치" },
      { factor: "작업 중 손가락 협착", measure: "지렛대 사용 시 손 위치 주의" },
      { factor: "고소 작업 중 추락", measure: "안전화 착용 및 작업 발판 확보" },
      { factor: "사면 미끄러짐", measure: "안전 로프 설치 및 이동로 확보" },
      { factor: "석재 운반 트럭 적재함 사고", measure: "자재 상하차 시 평탄지 주차" },
      { factor: "장시간 중량물 취급 요통", measure: "양중 기계 활용 적극 장려" }
    ]
  },
  {
    keywords: ["도로", "경계석", "보도블록", "깔기", "컷팅"],
    risks: [
      { factor: "블록 절단기(컷팅기) 칼날 접촉", measure: "칼날 덮개 설치 및 보안경 착용" },
      { factor: "경계석 인양 중 낙하", measure: "전용 집게(인양기) 점검 및 사용" },
      { factor: "중량물 반복 취급 근골격계 질환", measure: "교대 근무 및 기계화 시공 권장" },
      { factor: "통행 차량과 충돌", measure: "도로 차단 및 라바콘/표지판 설치" },
      { factor: "블록 분진 흡입", measure: "습식 절단 및 방진 마스크 착용" },
      { factor: "손가락 협착(블록 배치 시)", measure: "보호 장갑 착용 및 집게 도구 사용" },
      { factor: "지반 다짐기(컴팩타) 진동 장해", measure: "방진 장갑 착용 및 휴식 시간 부여" },
      { factor: "야외 열사병", measure: "그늘막 확보 및 수분 섭취" },
      { factor: "현장 자재에 걸려 넘어짐", measure: "자재 정리 및 보행 통로 확보" },
      { factor: "절단기 누전 감전", measure: "피복 점검 및 방수형 콘센트 사용" }
    ]
  },
  {
    keywords: ["고압세척", "준공청소", "물청소", "세척기", "화학약품"],
    risks: [
      { factor: "고압 분사수에 의한 신체 부상", measure: "분사구 방향 주의 및 전용 보호복 착용" },
      { factor: "세제(화학물질)에 의한 화학 화상", measure: "보호 장갑 및 보안경 착용" },
      { factor: "바닥 물기로 인한 미끄러짐", measure: "장화 착용 및 작업 구역 통제" },
      { factor: "전기 기구 물 유입으로 인한 감전", measure: "전기 시설 비닐 보양 및 전원 차단" },
      { factor: "고소 창문 청소 중 추락", measure: "안전대 체결 및 생명줄 확인" },
      { factor: "세척제 증기 질식(밀폐공간)", measure: "환기 실시 및 방독 마스크 착용" },
      { factor: "호스 꼬임으로 인한 넘어짐", measure: "호스 정리 및 통로 확보" },
      { factor: "세척 장비 소음 장해", measure: "귀마개 착용 및 장비 이격 배치" },
      { factor: "약품 혼합 시 가스 발생", measure: "약품 혼합 금지 및 MSDS 숙지" },
      { factor: "펌프 과부하 폭발", measure: "압력 밸브 점검 및 정격 사용" }
    ]
  },
  {
    keywords: ["모터", "펌프", "오버홀", "분해", "정비"],
    risks: [
      { factor: "불시 가동으로 인한 회전체 협착", measure: "LOTO 절차 이행 및 기동반 잠금" },
      { factor: "중량 모터 인양 중 낙하", measure: "체인 블록 사용 및 슬링 점검" },
      { factor: "세척유 사용 중 화재", measure: "유류 화재 소화기 비치 및 환기" },
      { factor: "전선 절단면 감전", measure: "무전압 확인 및 절연 테이핑" },
      { factor: "부품 분해 시 튕겨나감(스프링 등)", measure: "안면 보호구 착용 및 주의" },
      { factor: "그리스/오일 미끄러짐", measure: "바닥 청소 및 흡착포 비치" },
      { factor: "좁은 공간 작업 충돌", measure: "작업대 확보 및 정리정돈" },
      { factor: "중량물 인력 취급 요통", measure: "양중 장비 및 대차 사용" },
      { factor: "날카로운 부품 베임", measure: "방검 장갑 착용" },
      { factor: "오일 증기 흡입", measure: "방독 마스크 착용 및 환기" }
    ]
  },
  {
    keywords: ["컨베이어", "벨트", "롤러", "교체", "체인"],
    risks: [
      { factor: "컨베이어 롤러 말림(협착)", measure: "가동 중 정비 금지 및 비상정지 스위치 확보" },
      { factor: "벨트 텐션 조절 중 튕김", measure: "장력 제거 후 작업 및 보호구 착용" },
      { factor: "고소 컨베이어 작업 중 추락", measure: "안전 난간 발판 사용" },
      { factor: "공구 낙하로 하부 설비 파손", measure: "하부 통제 및 공구 고정" },
      { factor: "체인 구동부 손가락 절단", measure: "방호 덮개 유지 및 정비 시 전원 차단" },
      { factor: "정비 중 타인의 시동 버튼 조작", measure: "조작 금지 표지 부착 및 키 휴대" },
      { factor: "벨트 오염물 제거 중 부상", measure: "전용 도구 사용 및 가동 중지" },
      { factor: "모터 과열 화재", measure: "온도 센서 점검 및 가연물 제거" },
      { factor: "중량 롤러 운반 중 협착", measure: "인양 장비 활용" },
      { factor: "윤활유 접촉 피부염", measure: "보호 장갑 및 소매 착용" }
    ]
  },
  {
    keywords: ["화학물질", "배합", "소분", "유해물질", "유기용제"],
    risks: [
      { factor: "화학물질 증기 중독", measure: "국소배기장치 가동 및 방독 마스크" },
      { factor: "화학액 비산에 의한 눈 손상", measure: "고글 또는 안면 보호구 착용" },
      { factor: "정전기에 의한 화재/폭발", measure: "접지 실시 및 제전복 착용" },
      { factor: "물질 혼합 시 이상 발열/폭발", measure: "혼합 금지 물질 확인(MSDS)" },
      { factor: "피부 흡수 및 화상", measure: "불침투성 보호의 및 장갑 착용" },
      { factor: "용기 파손으로 인한 유출", measure: "이중 용기 사용 및 방유제 설치" },
      { factor: "소분 중 흘림 미끄러짐", measure: "흡착포 준비 및 즉시 제거" },
      { factor: "밀폐공간 내 유증기 체류", measure: "가스 농도 측정 및 환기" },
      { factor: "폐기물 처리 중 화재", measure: "지정 폐기물 용기 분리 보관" },
      { factor: "오취에 의한 현기증", measure: "적정 휴식 및 신선한 공기 확보" }
    ]
  },
  {
    keywords: ["샌드블라스팅", "탈청", "그릿", "압축공기", "연마"],
    risks: [
      { factor: "고압 분사 그릿에 의한 신체 타격", measure: "전용 보호의 및 후드 착용" },
      { factor: "미세 분진 흡입(규폐증)", measure: "송기 마스크 및 집진 설비 가동" },
      { factor: "압축 공기 호스 이탈(채찍 현상)", measure: "커플링 안전핀 체결 및 호스 점검" },
      { factor: "분진 폭발", measure: "제진 설비 및 방폭형 조명 사용" },
      { factor: "정전기 스파크 화재", measure: "노즐 및 피공물 접지" },
      { factor: "소음 장해", measure: "귀마개 및 귀덮개 중복 착용" },
      { factor: "진동에 의한 수완진동증후군", measure: "방진 장갑 착용 및 작업 시간 제한" },
      { factor: "고소 부재 블라스팅 중 추락", measure: "안전대 체결 및 추락 방지망" },
      { factor: "넘어짐 사고(그릿 산적)", measure: "바닥 주기적 청소 및 정리" },
      { factor: "시야 미확보에 의한 충돌", measure: "후드 창 닦이 및 충분한 조명" }
    ]
  },
  {
    keywords: ["중량물", "인력운반", "상자", "포대", "요통"],
    risks: [
      { factor: "부적절한 자세로 인한 요통 및 근골격계 질환", measure: "허리 펴고 무릎 굽혀 인양, 무게중심 근접 유지" },
      { factor: "운반 중 화물에 의한 시야 가림으로 전도", measure: "적정 높이 적재 및 운반로 시야 확보" },
      { factor: "화물 낙하에 의한 발등 골절", measure: "안전화 착용 및 손잡이 확실히 파지" },
      { factor: "협소한 통로 이동 중 벽면 협착", measure: "통로 폭 최소 80cm 확보 및 자재 정리" },
      { factor: "과도한 중량물 단독 운반", measure: "2인 1조 작업 또는 운반 대차 활용" },
      { factor: "포대 자재 터짐으로 인한 분진 흡입", measure: "조심스러운 하역 및 방진마스크 착용" },
      { factor: "계단 이동 중 미끄러짐", measure: "계단 논슬립 설치 및 난간 이용" },
      { factor: "화물의 날카로운 모서리에 베임", measure: "가죽 보호 장갑 착용 및 보완 조치" },
      { factor: "반복 작업에 의한 손목/어깨 장해", measure: "작업 중간 스트레칭 및 순환 근무" },
      { factor: "운반 중 타 작업자와 충돌", measure: "진행 방향 확인 및 유도 구호 사용" }
    ]
  },
  {
    keywords: ["샌드위치판넬", "지붕", "벽체", "스크류볼트", "조립"],
    risks: [
      { factor: "지붕 판넬 이동 중 밟음 추락", measure: "판넬 위 안전 통로(발판) 설치 및 안전대 체결" },
      { factor: "판넬 인양 중 강풍에 의한 흔들림/충돌", measure: "유도 로프 사용 및 초속 10m 이상 작업 중지" },
      { factor: "날카로운 판넬 단면에 베임", measure: "방검 장갑 착용 및 마감재 즉시 설치" },
      { factor: "고소작업대(스카이) 작업 중 떨어짐", measure: "작업대 난간 밖으로 몸 내밀기 금지" },
      { factor: "스크류 볼트 체결 공구(임팩트) 반동 부상", measure: "공구 파지 철저 및 작업 자세 안정" },
      { factor: "판넬 하부 작업자 낙하물 타격", measure: "하부 통제 및 안전모 착용" },
      { factor: "판넬 절단 시 불꽃에 의한 화재", measure: "심재 가연성 확인 및 소화기 비치" },
      { factor: "양중 중 판넬 이탈 낙하", measure: "전용 인양 집게 사용 및 결속 점검" },
      { factor: "판넬 무게 중심 상실로 전도", measure: "수직 적재 시 전도 방지 버팀대 설치" },
      { factor: "벽체 조립 중 손가락 협착", measure: "지렛대 활용 및 손 위치 주의" }
    ]
  },
  {
    keywords: ["데크플레이트", "깔기", "트러스", "슬래브"],
    risks: [
      { factor: "데크 끝단 개구부 추락", measure: "안전 난간 즉시 설치 및 안전대 체결" },
      { factor: "데크 하부 가설 지지대(서포트) 붕괴", measure: "구조 검토에 따른 지지대 배치 및 고정" },
      { factor: "철근 일체형 데크 인양 중 찔림", measure: "보호 장갑 착용 및 인양 반경 접근 금지" },
      { factor: "테두리 빔(Beam) 용접 중 화재", measure: "불티 방지포 설치 및 화기 감시인 배치" },
      { factor: "데크플레이트 과적재로 인한 붕괴", measure: "적재 하중 분산 및 집중 적재 금지" },
      { factor: "이동 중 데크 틈새 발 빠짐", measure: "틈새 즉시 보강 및 안전 통로 확보" },
      { factor: "전기 스터드 용접 중 감전", measure: "전격 방지기 설치 및 피복 점검" },
      { factor: "강풍에 의한 데크 날림", measure: "작업 종료 시 즉시 고정 용접 실시" },
      { factor: "절단기 사용 중 파편 비래", measure: "보안경 및 안면 보호구 착용" },
      { factor: "데크 하부 동바리 설치 중 추락", measure: "하부 작업용 발판 및 사다리 점검" }
    ]
  },
  {
    keywords: ["가설사무실", "컨테이너", "안착", "전기인입", "정화조"],
    risks: [
      { factor: "크레인 인양 중 컨베이너 낙하", measure: "4줄 걸이 및 수평 확인, 샤클 체결" },
      { factor: "컨테이너 하부 기초 침하로 전도", measure: "지반 다짐 및 콘크리트 패드/침목 설치" },
      { factor: "전기 인입 작업 중 누전/감전", measure: "외함 접지 및 누전 차단기 필수 설치" },
      { factor: "컨테이너 지붕 위 작업 중 추락", measure: "사다리 고정 및 이동 시 추락 방지 조치" },
      { factor: "정화조 굴착면 붕괴", measure: "굴착 법면 기울기 준수 및 통제" },
      { factor: "상하차 작업 중 협착", measure: "컨테이너 하부 발 넣기 금지 및 유도원 배치" },
      { factor: "화장실 배관 연결 중 배관 베임", measure: "전용 절단기 사용 및 장갑 착용" },
      { factor: "계단/난간 설치 불량으로 인한 추락", measure: "영구 고정 방식의 견고한 볼팅" },
      { factor: "자재 운반 차량과의 충돌", measure: "현장 내 통제 유도원 상주" },
      { factor: "컨테이너 내부 용접 중 화재", measure: "내부 가연물 제거 및 소화기 비치" }
    ]
  },

  {
    keywords: ["가설물용수", "임시배관", "펌프", "물탱크", "수압"],
    risks: [
      { factor: "배관 연결부 파열로 인한 침수", measure: "정격 압력 준수 및 연결부 결속 점검" },
      { factor: "펌프 전원부 누전 감전", measure: "방수형 콘센트 사용 및 접지 확인" },
      { factor: "물탱크 상부 개구부 추락", measure: "탱크 상부 덮개 잠금 및 안전난간" },
      { factor: "겨울철 동파로 인한 빙판길 전도", measure: "배관 보온 조치 및 누수 시 즉시 제거" },
      { factor: "중량 배관 인력 운반 요통", measure: "2인 1조 작업 및 기계식 운반" },
      { factor: "배관 절단기(나사절삭기) 협착", measure: "가동 중 장갑 착용 금지 및 보호구" },
      { factor: "가설 펌프실 환기 부족/질식", measure: "지하 설치 시 강제 환기 및 측정" },
      { factor: "수압 시험 중 배관 튕김", measure: "배관 고정 밴드 강화 및 위험 구역 통제" },
      { factor: "산소 절단 화기 사고", measure: "주변 가연물 제거 및 소화기 비치" },
      { factor: "트렌치 작업 중 전도", measure: "개구부 덮개 또는 안전 표시" }
    ]
  },
  {
    keywords: ["측량", "레벨", "광파기", "스타프", "부지정리"],
    risks: [
      { factor: "건설 장비와 측량 작업자 충돌", measure: "고휘도 안전조끼 착용 및 장비 신호수 배치" },
      { factor: "사면 측량 중 미끄러짐/굴러짐", measure: "안전화 착용 및 사면 안전 로프 이용" },
      { factor: "가시덤불 및 못 찔림", measure: "방검 장화 착용 및 작업로 정리" },
      { factor: "측량 핀(못) 타격 시 파편 비래", measure: "보안경 착용 및 해머 고정 점검" },
      { factor: "도로 인근 측량 중 교통 사고", measure: "라바콘 설치 및 싸인카 배치" },
      { factor: "맨홀 내부 측량 중 질식", measure: "작업 전 가스 농도 측정 및 환기" },
      { factor: "야외 햇빛 장기 노출 온열 질환", measure: "충분한 수분 섭취 및 그늘 휴식" },
      { factor: "고소 단부 측량 중 추락", measure: "안전대 체결 및 개구부 접근 주의" },
      { factor: "지하 매설물 오측량으로 인한 파손", measure: "지하시설물 도면 병행 확인" },
      { factor: "무거운 장비(삼각대 등) 운반 중 부상", measure: "전용 케이스 사용 및 안전 통로 확보" }
    ]
  },
  {
    keywords: ["용접", "절단", "그라인더", "화기", "불꽃", "불티", "화재", "화재감시"],
    risks: [
      { factor: "불티 비산에 의한 주변 가연물 화재 및 폭발", measure: "화기작업 허가서 발행, 불티 방지포 설치 및 소화기 근접 배치" },
      { factor: "유해 흄 및 가스 흡입으로 인한 호흡기 질환", measure: "특급 방진마스크 착용 및 국소배기장치(이동식 송풍기) 가동" },
      { factor: "고열 물체 접촉에 의한 신체 화상", measure: "내열 장갑, 가죽 앞치마 및 각반 등 전용 보호구 착용" },
      { factor: "용접 광선(자외선/적외선)에 의한 안구 및 피부 손상", measure: "용접 보안면 및 차광 안경 착용, 주변 차광막 설치" },
      { factor: "가스 용기(아세틸렌/산소) 전도 및 폭발", measure: "용기 전용 대차 사용, 역화 방지기 설치 확인 및 캡 씌우기" },
      { factor: "홀더선 피복 손상에 의한 전격(감전)", measure: "자동 전격 방지기 설치 및 피복 손상 유무 사전 점검" },
      { factor: "작업장 내 인화성 증기 체류에 의한 폭발", measure: "작업 전 가스 농도 측정 및 지속적 환기 실시" },
      { factor: "불꽃 반사에 의한 비작업자 시력 저하", measure: "작업 구역 구획 설정 및 관계자 외 출입 통제 표지판 설치" },
      { factor: "좁은 장소 작업 시 산소 결핍 및 질식", measure: "작업 전·중 산소 농도 측정 및 감시인 배치" },
      { factor: "작업 종료 후 잔류 불씨에 의한 화재", measure: "작업 종료 후 1시간 이상 화재 감시인 상주 점검" }
    ]
  },
  {
    keywords: ["사다리", "비계", "지붕", "고소", "높은", "천장"],
    risks: [
      { factor: "작업 중 중심 상실로 인한 떨어짐(추락)", measure: "안전대(Full Body Harness) 착용 및 생명줄 체결 철저" },
      { factor: "사다리 전도 및 미끄러짐", measure: "2인 1조 작업(하부 지지) 및 아웃트리거/미끄럼방지 조치" },
      { factor: "상부 자재 및 공구 낙하로 인한 하부 작업자 타격", measure: "하부 통제, 안전모 턱끈 체결 및 공구 낙하방지 끈 사용" },
      { factor: "비계 구조물 강도 부족에 의한 붕괴", measure: "벽 이음 설치 준수 및 최대 적재 하중 표지판 게시" },
      { factor: "발판 사이 틈새 및 단부로 인한 발 빠짐", measure: "작업 발판 빈틈없이 설치 및 안전 난간대 설치" },
      { factor: "지붕 작업 중 채광창(렉산) 파손에 의한 추락", measure: "채광창 보호 덮개 설치 또는 안전 통로(발판) 확보" },
      { factor: "강풍 등 악천후 시 고소 작업 중 추락", measure: "악천후 시 작업 중지 가이드라인 준수 및 대피" },
      { factor: "이동식 비계(BT) 이동 중 전도", measure: "비계 위 작업자 탑승 상태에서 이동 금지, 바퀴 스토퍼 체결" },
      { factor: "승강 통로 미비로 인한 비정상적 승하강 중 사고", measure: "전용 승강 계단 설치 및 사다리 상부 돌출 길이 확보" },
      { factor: "안전 난간 임의 해체 후 미복구에 의한 사고", measure: "해체 시 별도 승인 절차 수행 및 즉시 원상 복구" }
    ]
  },
  {
    keywords: ["전기", "배선", "단자", "활선", "케이블", "접지"],
    risks: [
      { factor: "충전부 직접 접촉에 의한 감전", measure: "전원 차단(LOTO) 및 절연 장갑/장화 등 절연 보호구 착용" },
      { factor: "합선(단락)에 의한 강력한 아크 화상", measure: "절연 장갑 착용 및 절연 처리된 전용 공구 사용" },
      { factor: "절연 파괴에 의한 기기 외함 누전 감전", measure: "기기 외함 접지 상태 확인 및 누전 차단기 통과 전원 사용" },
      { factor: "케이블 피복 손상부 노출에 의한 감전", measure: "전선 가공 배선 또는 케이블 보호 튜브(트러프) 설치" },
      { factor: "습한 환경에서의 전기 조작으로 인한 누전", measure: "수분 제거 후 작업 및 절연 발판 설치" },
      { factor: "전선 과부하에 의한 과열 및 전기 화재", measure: "허용 전류 준수 및 멀티탭 문어발식 사용 금지" },
      { factor: "정전용량(잔류 전하)에 의한 감전", measure: "검전기를 이용한 무전압 확인 및 잔류 전하 방전 조치" },
      { factor: "고압선 인근 작업 중 비래(Arc) 감전", measure: "충전부와의 이격 거리 준수 및 절연 방호구 설치" },
      { factor: "배전반 내 금속체(드라이버 등) 유입에 의한 단락", measure: "배전반 밀폐 관리 및 작업 전 내부 상시 점검" },
      { factor: "임시 배전반의 침수로 인한 누전", measure: "높은 곳 설치 및 방우형 구조(IP등급 확인) 사용" }
    ]
  },
  {
    keywords: ["밀폐", "탱크", "맨홀", "피트", "질식"],
    risks: [
      { factor: "산소 결핍에 의한 질식 및 의식 불명", measure: "작업 전 및 작업 중 지속적 산소 농도 측정(18% 이상)" },
      { factor: "유해가스(황화수소, 일산화탄소 등) 중독", measure: "송기마스크 또는 공기호흡기 착용 및 외부 감시인 배치" },
      { factor: "가연성 가스 체류에 의한 폭발 및 화재", measure: "방폭형 조명 및 방폭형 환기 팬 사용, 화기 금지" },
      { factor: "외부와의 연락 두절로 인한 구조 지연", measure: "내부 작업자와 감시인 간 전용 통신 장비(무전기) 운용" },
      { factor: "밀폐 공간 내 수직 이동 중 추락", measure: "구조용 삼각대 및 윈치 설치, 안전대 상시 착용" },
      { factor: "사고 발생 시 비전문적 구조 중 동반 질식", measure: "비상 구조 절차 숙지 및 자급식 호흡기 착용 후 진입" },
      { factor: "장시간 작업 시 환기 사각지대 발생", measure: "환기 호스를 작업 지점(심부)까지 연장 배치" },
      { factor: "내부 바닥 미끄러짐 및 돌출물에 의한 부상", measure: "미끄럼 방지화 착용 및 내부 조도 확보(75럭스 이상)" },
      { factor: "작업 전 출입 허가 절차 미준수", measure: "밀폐공간 보건작업 프로그램 이행 및 출입 인원 기록" },
      { factor: "인접 배관을 통한 유해물질 유입", measure: "인입 배관 차단(Blind) 조치 및 밸브 잠금장치 설치" }
    ]
  },
  {
    keywords: ["크레인", "인양", "호이스트", "양중", "줄걸이"],
    risks: [
      { factor: "인양 중 자재 낙하(물체에 맞음)", measure: "인양 반경 내 출입 금지 펜스 설치 및 전담 유도원 배치" },
      { factor: "와이어로프 및 슬링벨트 파단", measure: "작업 전 줄걸이 용구 점검 및 정격하중(SWL) 준수" },
      { factor: "인양물의 회전 및 흔들림에 의한 충돌", measure: "보조 로프(Tag Line)를 사용하여 인양물 방향 조절" },
      { factor: "크레인 전도(넘어짐)", measure: "지반 지지력 확인 및 아웃트리거 받침판(침목) 사용" },
      { factor: "권과방지장치 미작동으로 인한 자재 낙하", measure: "작업 전 권과방지 및 과부하 방지장치 작동 여부 점검" },
      { factor: "줄걸이 체결 불량으로 인한 자재 이탈", measure: "2줄 걸이 원칙 준수 및 무게 중심 확인 후 가인양 실시" },
      { factor: "훅(Hook) 해지 장치 이탈에 의한 낙하", measure: "훅 해지 장치(Safety Latch) 파손 여부 확인 및 즉시 교체" },
      { factor: "운전원과 신호수 간 신호 불일치로 인한 사고", measure: "표준 수신호 사용 또는 전용 무전 채널 확보" },
      { factor: "붐대 선회 중 주변 구조물 충돌", measure: "선회 반경 내 장애물 제거 및 충돌 방지 센서 확인" },
      { factor: "사각지대 작업자 위치 선정 오류로 인한 사고", measure: "운전원 시야 확보 및 상시 작업 인원 파악" }
    ]
  },
  {
    keywords: ["굴착", "터파기", "포크레인", "덤프"],
    risks: [
      { factor: "굴착 법면 붕괴로 인한 매몰", measure: "지반 상태 점검, 법면 기울기 준수 및 흙막이 지보공 설치" },
      { factor: "건설 기계(굴착기 등)와 작업자 충돌", measure: "신호수 배치 및 장비 후방 카메라/어라운드뷰 확인" },
      { factor: "지하 매설물(가스관, 케이블) 파손에 의한 폭발/전격", measure: "작업 전 지하매설물도 확인 및 시굴착 실시" },
      { factor: "굴착 단부 장비 전도", measure: "굴착 어깨 부분 하중 금지 및 장비 진입로 다짐 강화" },
      { factor: "굴착 하부로 자재 및 암석 낙하", measure: "굴착 상부 토사 더미 이격(1m 이상) 배치 및 안전모 착용" },
      { factor: "중기 운행 경로의 지반 침하", measure: "장비 이동로 철판 포설 및 지반 상태 수시 점검" },
      { factor: "장비 가동 범위 내 비작업자 진입", measure: "유도원에 의한 통제 및 장비 근접 접근 금지" },
      { factor: "굴착기 버킷 이탈에 의한 타격", measure: "퀵 커플러 안전핀 체결 여부 운전석 내 상시 확인" },
      { factor: "상하 동시 작업 시 하부 작업자 타격", measure: "상하 동시 작업 금지 및 작업 구간 물리적 격리" },
      { factor: "장비 승하차 중 미끄러짐 및 추락", measure: "3점 지지 원칙 준수 및 계단/손잡이 오염 제거" }
    ]
  },
  {
    keywords: ["방화재", "내화충진", "우레탄폼", "충진", "코킹"],
    risks: [
      { factor: "내화액/폼 접촉 피부염", measure: "불침투성 장갑 및 방진복 착용" },
      { factor: "밀폐 구역 폼 분사 중 질식", measure: "송풍기 가동 및 가스 농도 측정" },
      { factor: "고소 틈새 작업 중 추락", measure: "말비계 난간 준수 및 안전대 체결" },
      { factor: "충진재 주입 시 눈 비산", measure: "보안경 또는 고글 상시 착용" },
      { factor: "우레탄폼 캔 폭발(열기 노출 시)", measure: "직사광선 피하고 화기 엄금" },
      { factor: "칼(커터) 사용 중 손가락 베임", measure: "방검 장갑 착용 및 칼날 관리" },
      { factor: "작업 부산물에 의한 미끄러짐", measure: "바닥 청소 및 폐기물 즉시 수거" },
      { factor: "전선실 입구 충돌 부상", measure: "충분한 조명 확보 및 머리 보호구(안전모)" },
      { factor: "시너 등 세척제 중독", measure: "방독마스크 착용 및 환기" },
      { factor: "충진재 중량물 운반 요통", measure: "대차 활용 및 적정 하중 분산" }
    ]
  },
  {
    keywords: ["방음벽", "지주설립", "방음판", "고소작업대", "양중"],
    risks: [
      { factor: "방음판 인양 중 낙하", measure: "전용 양중기구 점검 및 하부 출입 통제" },
      { factor: "지주 볼트 체결 중 손가락 협착", measure: "수공구 사용 및 2인 1조 수신호" },
      { factor: "고소작업대 상승 중 구조물 부딪힘", measure: "상부 확인 및 유도원 배치" },
      { factor: "방음벽 기초 굴착면 전도", measure: "지반 다짐 및 장비 수평 유지" },
      { factor: "지주 용접 중 화재", measure: "불티 방지포 설치 및 화기 감시인" },
      { factor: "강풍 시 방음판 수풍부담으로 인한 흔들림", measure: "풍속 확인 및 강풍 시 작업 중단" },
      { factor: "도로변 작업 중 차량 충돌", measure: "교통 통제 요원 및 싸인카 운영" },
      { factor: "전동 임팩트 사용 중 누전", measure: "절연 성능 확인 및 차단기 점검" },
      { factor: "방음판 단부 날카로운 부위 베임", measure: "보호 장갑 착용" },
      { factor: "방음판 적재함 무너짐", measure: "평탄지 적재 및 고정 로프 체결" }
    ]
  },
  {
    keywords: ["가스배관", "기밀시험", "퍼지", "도시가스", "나사절삭"],
    risks: [
      { factor: "기밀 시험 중 고압 폭발", measure: "단계별 승압 및 위험 구역 격리" },
      { factor: "가스 누출에 의한 질식/폭발", measure: "가스 검지기 휴대 및 환기 실시" },
      { factor: "배관 나사 절삭기 협착", measure: "장갑 착용 금지 및 비상정지 스위치 확인" },
      { factor: "고소 배관 용접 중 추락", measure: "고소작업대 사용 및 안전대 체결" },
      { factor: "배관 내부 이물질 제거 중 눈 부상", measure: "압축 공기 사용 시 보안경 필수" },
      { factor: "중량 배관 양중 중 낙하", measure: "슬링벨트 점검 및 인양 반경 통제" },
      { factor: "산소 결핍 공간 작업(피트 등)", measure: "산소 농도 측정 및 송풍기 가동" },
      { factor: "배관 도색 작업 중 시너 중독", measure: "방독마스크 착용 및 환기" },
      { factor: "플랜지 체결 시 손가락 협착", measure: "지렛대 사용 및 손 위치 주의" },
      { factor: "퍼지(Purge) 작업 중 화재", measure: "배출구 주변 화기 엄격 제한" }
    ]
  },
  {
    keywords: ["표지판", "안전시설", "차선도색", "라바콘", "설치"],
    risks: [
      { factor: "차선 도색기 고열 아스팔트 화상", measure: "내열 보호구 착용 및 접촉 주의" },
      { factor: "도로 위 작업 중 주행 차량 충돌", measure: "싸인카, 점멸등 및 신호수 배치" },
      { factor: "표지판 지주 굴착 중 매설물 파손", measure: "작업 전 매설물 탐지 및 인력 굴착 병행" },
      { factor: "중량 표지판 인양 중 전도", measure: "이동식 크레인 아웃트리거 지지 확인" },
      { factor: "도색 페인트 증기 흡입", measure: "방독마스크 착용 및 바람 등지고 작업" },
      { factor: "표지판 볼트 체결 중 추락", measure: "사다리 2인 1조 또는 고소작업대 활용" },
      { factor: "야간 작업 중 조도 부족 사고", measure: "투광등 설치 및 개인 발광 장구" },
      { factor: "표지판 단면 베임", measure: "방검 장갑 착용 및 단부 처리" },
      { factor: "압축 공기 호스 이탈(도색기)", measure: "커플링 안전핀 확인" },
      { factor: "지반 약화로 인한 지주 전도", measure: "콘크리트 기초 양생 확인 및 지지" }
    ]
  },
  {
    keywords: ["정화조", "물탱크", "지하매설", "굴착", "거치"],
    risks: [
      { factor: "굴착 법면 붕괴로 인한 매몰", measure: "흙막이 지보공 설치 및 기울기 준수" },
      { factor: "정화조 인양 중 슬링벨트 파단", measure: "정격 하중 준수 및 줄걸이 사전 점검" },
      { factor: "지하 피트 내 작업 중 산소 결핍", measure: "산소/유해가스 측정 및 환기" },
      { factor: "상부 개구부 작업자 추락", measure: "안전 난간 및 덮개 설치" },
      { factor: "지하수 용출로 인한 지반 약화", measure: "집수정 및 배수 펌프 가동" },
      { factor: "장비(굴착기) 선회 중 충돌", measure: "신호수 배치 및 작업 반경 통제" },
      { factor: "내부 배관 연결 중 협착", measure: "좁은 공간 작업 시 머리 보호구 및 자세 주의" },
      { factor: "정화조 상부 과적재로 인한 파손", measure: "상부 하중 제한 및 통행 금지" },
      { factor: "전기 펌프 설치 중 누전", measure: "방수 전선 사용 및 누전 차단기 점검" },
      { factor: "사다리 이동 중 미끄러짐", measure: "고정식 사다리 또는 전용 승강구 설치" }
    ]
  },
  {
    keywords: ["작업준비", "공통안전", "작업전", "환경점검", "허가서", "TBM", "비상대피"],
    risks: [
      { factor: "작업허가(PTW) 미승인 상태에서 위험 작업 강행", measure: "화기·밀폐·고소 등 고위험 작업 전 승인 절차 완료 확인" },
      { factor: "에너지 차단 미비로 인한 기계의 불시 가동", measure: "전원/밸브 차단 후 LOTO(잠금 및 표지) 및 키 보관 철저" },
      { factor: "강풍·강우 등 악천후 시 고소 및 양중 작업", measure: "풍속 10m/s 이상 시 작업 중단 및 기상 모니터링 체계 가동" },
      { factor: "상·하부 동시 작업 시 낙하물에 의한 타격", measure: "상하 동시 작업 원칙적 금지 및 부득이할 시 방호 선반 설치" },
      { factor: "지하시설물 정보 미확인 상태에서 굴착/항타", measure: "매설물 도면 확인 및 가스·전기 탐지기 활용 사전 조사" },
      { factor: "장비 사각지대로 인한 보행 작업자 충돌", measure: "전담 신호수/유도원 배치 및 장비 접근 금지 구역 설정" },
      { factor: "비상연락망 및 구조 체계 미비로 대응 지연", measure: "현장 무전기 점검 및 인근 병원 이송 경로 사전 확보" },
      { factor: "조도 부족으로 인한 전도 및 오조작", measure: "야간 및 실내 작업 시 기준 조도(75럭스 이상) 확보" },
      { factor: "화학물질 유해성 미숙지로 인한 중독 사고", measure: "취급 물질 MSDS 교육 실시 및 현장 내 경고 표지 부착" },
      { factor: "신규/미숙련 작업자의 작업 내용 오인지", measure: "TBM(Tool Box Meeting)을 통한 작업 순서 및 위험 요인 전파" }
    ]
  },
  {
    keywords: ["압축기", "콤프레샤", "에어탱크", "압력용기", "에어호스"],
    risks: [
      { factor: "압력용기(탱크) 부식 및 노후로 인한 폭발", measure: "안전밸브 작동 시험 및 공인기관 정기검사 이행" },
      { factor: "고압 에어호스 이탈에 의한 타격(채찍 현상)", measure: "호스 연결부 커플링 안전핀 체결 및 전용 클립 사용" },
      { factor: "압축기 실린더/커플링 회전체 협착", measure: "구동부 방호 덮개 설치 및 가동 중 정비 엄금" },
      { factor: "에어 분사수로 이물질이 눈에 들어감(비래)", measure: "보안경 착용 및 신체를 향한 에어 분사 금지" },
      { factor: "압축기 과열에 의한 화재", measure: "가연물 이격 배치 및 오일 레벨/냉각팬 상시 점검" },
      { factor: "고압 공기 급격한 방출에 의한 청력 손상", measure: "소음기 설치 및 작업자 귀마개 착용" },
      { factor: "탱크 내 응축수 미배출로 인한 부식 위험", measure: "드레인 밸브를 통한 주기적 응축수 배출" },
      { factor: "전동기 절연 파괴에 의한 외함 감전", measure: "외함 접지 확인 및 누전 차단기 점검" },
      { factor: "이동식 압축기 경사면 전도", measure: "평탄 지반 거치 및 바퀴 스토퍼 체결" },
      { factor: "압력계 오작동으로 인한 과압 발생", measure: "압력계 정기 교정 및 예비 안전장치 확보" }
    ]
  },
  {
    keywords: ["펌프", "양수기", "수중펌프", "임펠러", "토출관"],
    risks: [
      { factor: "수중펌프 전선 피복 손상으로 인한 수중 감전", measure: "이동형 누전차단기 사용 및 인양 시 전선 당기기 금지" },
      { factor: "펌프 임펠러에 손가락 협착", measure: "분해 소각 시 LOTO(전원 잠금) 필수 및 수공구 사용" },
      { factor: "토출측 밸브 급폐쇄 시 수격현상(Water Hammer) 파열", measure: "밸브 서서히 개폐 및 체크밸브 상태 점검" },
      { factor: "펌프 공회전(Dry Run)에 의한 과열 및 화재", measure: "액위 센서 연동 및 공회전 방지 장치 점검" },
      { factor: "누수 발생으로 인한 주변 미끄러짐", measure: "연결부 실링(Sealing) 확인 및 바닥 배수 처리" },
      { factor: "약품 펌프 누출로 인한 화학적 화상", measure: "내화학 보호구 착용 및 누출 방지 턱(Dike) 설치" },
      { factor: "중량 펌프 거치 작업 중 발등 협착", measure: "안전화 착용 및 체인 블록 등 양중 장비 활용" },
      { factor: "고압 펌프 가동 중 배관 진동에 의한 탈락", measure: "배관 지지대(Support) 보강 및 진동 방지 패드 설치" },
      { factor: "좁은 피트 내 펌프 점검 중 질식", measure: "작업 전 산소 농도 측정 및 강제 환기" },
      { factor: "펌프 기동 시 급격한 반동에 의한 부상", measure: "기초 베이스 앵커 볼트 체결 상태 확인" }
    ]
  },
  {
    keywords: ["파일정리", "두부정리", "컷팅", "파쇄", "잔재처리"],
    risks: [
      { factor: "핸드브레이커 진동에 의한 수완진동증후군", measure: "방진 장갑 착용 및 교대 근무" },
      { factor: "파일 컷팅 시 파편 비래", measure: "안면 보호구 및 보안경 필수 착용" },
      { factor: "파일 상부 절단물 낙하에 의한 발등 타격", measure: "안전화 착용 및 작업 반경 통제" },
      { factor: "분진 대량 발생으로 호흡기 질환", measure: "방진마스크 착용 및 살수 실시" },
      { factor: "컷팅기 누전 감전", measure: "피복 점검 및 누전 차단기 통과 전원" },
      { factor: "장비(백호) 브레이커 작업 시 충돌", measure: "신호수 배치 및 유격 거리 확보" },
      { factor: "절단된 파일 잔재에 걸려 넘어짐", measure: "즉각적인 잔재 반출 및 정리" },
      { factor: "소음으로 인한 청력 저하", measure: "귀마개 등 청력 보호구 착용" },
      { factor: "파일 인양 고리 손상으로 낙하", measure: "인양 전 고리 용접부 점검" },
      { factor: "경사면 파일 작업 중 미끄러짐", measure: "평탄 작업로 확보 및 미끄럼 방지화" }
    ]
  }
];

// ----------------------------------------------------------------------
// [로직] 텍스트에서 키워드를 찾아 DB에서 꺼내오는 함수
// ----------------------------------------------------------------------
const getRisksFromLocalDB = (text = "") => {
  let foundRisks = [];

  // 1. DB 순회하며 키워드 매칭
  RISK_DATABASE.forEach(category => {
    // 해당 카테고리의 키워드가 하나라도 포함되어 있는지 확인
    const hasKeyword = category.keywords.some(keyword => text.includes(keyword));
    if (hasKeyword) {
      foundRisks = [...foundRisks, ...category.risks];
    }
  });

  // 2. 매칭된 게 없으면 기본값 제공
  if (foundRisks.length === 0) {

  }

  return foundRisks;
};


// ----------------------------------------------------------------------
// [메인 컴포넌트]
// ----------------------------------------------------------------------
export default function Analysis() {
  const navigate = useNavigate();
  const location = useLocation();
  const scrollRef = useRef(null);

const {
  procedures = [],
  formData = {},
  participants = [],
  analysisData: incomingAnalysisData,
} = location.state || {};

// Analysis.jsx 내부

// Analysis.jsx 내부 수정 제안

// 1. 초기값: 이전 단계(Procedure)에서 넘겨준 분석 데이터가 있다면 그것을 우선 사용
const [analysisData, setAnalysisData] = useState(incomingAnalysisData || []);

// 2. 동기화 로직 보강
useEffect(() => {
  if (procedures && procedures.length > 0) {
    setInsideAnalysisData(); // 함수화하거나 아래 로직 실행
  }
}, [procedures]);

const setInsideAnalysisData = () => {
  setAnalysisData(prevData => {
    // 1순위: 현재 상태값, 2순위: 전달받은 초기값
    const baseData = prevData.length > 0 ? prevData : (incomingAnalysisData || []);
    
    return procedures.map((newProc, idx) => {
      const existingData = baseData.find(d => d.id === idx);
      if (existingData) {
        return { ...existingData, proc: newProc }; // 절차 내용만 최신으로 갱신
      }
      return { id: idx, proc: newProc, risks: [], frequency: 1, severity: 1, riskLevel: 1 };
    });
  });
};

  const [activeIdx, setActiveIdx] = useState(0);
  const [recommendations, setRecommendations] = useState([]);

  // 로딩 상태가 필요 없지만 UI 일관성을 위해 유지 (즉시 완료됨)
  const [isLoading, setIsLoading] = useState(false);

// 기존: const currentStep = analysisData[activeIdx];
// 수정: 데이터가 없을 경우를 대비한 방어 코드
const currentStep = analysisData && analysisData[activeIdx] ? analysisData[activeIdx] : { proc: {}, risks: [] };


  // --------------------------------------------------------------------
  // [실행] DB 조회 (동기 방식이라 매우 빠름)
  // --------------------------------------------------------------------
  useEffect(() => {
    if (currentStep?.proc?.stepDetail) {
      setIsLoading(true);

      // 약간의 지연(0.3초)을 주어 분석하는 느낌을 줌 (선택사항)
      setTimeout(() => {
        const results = getRisksFromLocalDB(currentStep.proc.stepDetail);
        setRecommendations(results);
        setIsLoading(false);
      }, 300);

      if (scrollRef.current) scrollRef.current.scrollLeft = 0;
    }
  }, [activeIdx]);


  // --------------------------------------------------------------------
  // [핸들러] (기존 동일)
  // --------------------------------------------------------------------
const scroll = (direction) => {
  if (scrollRef.current) {
    const { scrollLeft, clientWidth } = scrollRef.current;
    // 한번 클릭 시 카드 한 개 정도의 너비(약 250px)만큼 이동하게 설정
    const scrollAmount = 260; 
    scrollRef.current.scrollTo({ 
      left: scrollLeft + (direction === 'left' ? -scrollAmount : scrollAmount), 
      behavior: 'smooth' 
    });
  }
};
  const addRisk = (rec) => {
    const newData = [...analysisData];
    const isManual = rec.type === 'manual';
    const newRisk = {
      id: `risk-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      factor: isManual ? '' : rec.factor,
      measure: isManual ? '' : rec.measure
    };
    newData[activeIdx].risks.push(newRisk);
    setAnalysisData(newData);
  };

  const updateRiskContent = (riskId, field, value) => {
    const newData = [...analysisData];
    const targetStep = newData[activeIdx];
    targetStep.risks = targetStep.risks.map(risk =>
      risk.id === riskId ? { ...risk, [field]: value } : risk
    );
    setAnalysisData(newData);
  };

  const deleteRisk = (riskId) => {
    const newData = [...analysisData];
    newData[activeIdx].risks = newData[activeIdx].risks.filter(risk => risk.id !== riskId);
    setAnalysisData(newData);
  };

  const updateStepRisk = (field, value) => {
    const newData = [...analysisData];
    const target = newData[activeIdx];
    if (field === 'frequency' || field === 'severity') {
      target[field] = parseInt(value);
      target.riskLevel = target.frequency * target.severity;
    } else {
      target[field] = value;
    }
    setAnalysisData(newData);
  };

  const handleNext = () => {
    if (activeIdx < analysisData.length - 1) {
      setActiveIdx(activeIdx + 1);
    } else {
      navigate('/export', { state: { analysisData, formData, participants, procedures } });
    }
  };

  const handlePrev = () => {
    if (activeIdx === 0) {
      navigate('/procedure', { state: { procedures, formData, participants, analysisData } });
    } else {
      setActiveIdx(activeIdx - 1);
    }
  };

  return (
    <div style={styles.wrapper}>
      <div style={styles.bgWrapper}>
        <div style={styles.bgImage} />
        <div style={styles.dimOverlay} />
      </div>

      <header style={styles.header}>
        <h1 style={styles.logo} onClick={() => navigate('/')}>Smart JSA Bridge</h1>
      </header>

      <div style={styles.mainLayout}>
        <aside style={styles.sideAd}>
          <div style={styles.adPlaceholder}>AD Area 1</div>
        </aside>

        <main style={styles.centerContent}>
          <div style={styles.formCard}>

            <nav style={styles.stepper}>
              <div style={styles.stepItemDone}><div style={styles.stepBadgeDone}>✓</div><span style={styles.stepTextDone}>기본 정보</span></div>
              <div style={styles.stepLineActive} />
              <div style={styles.stepItemDone}><div style={styles.stepBadgeDone}>✓</div><span style={styles.stepTextDone}>작업 절차</span></div>
              <div style={styles.stepLineActive} />
              <div style={styles.stepItemActive}><div style={styles.stepBadgeActive}>3</div><span style={styles.stepTextActive}>위험 분석</span></div>
              <div style={styles.stepLine} />
              <div style={styles.stepItem}><div style={styles.stepBadge}>4</div><span style={styles.stepText}>최종 출력</span></div>
            </nav>

            <div style={styles.formHeader}>
              <h2 style={styles.formTitle}>03. 유해·위험요인 분석 ({activeIdx + 1}/{analysisData.length})</h2>
              <div style={styles.stepContext}>
                <span style={styles.stepTitleBadge}>STEP {activeIdx + 1}. {currentStep?.proc?.stepTitle}</span>
                <p style={styles.stepDetailText}>{currentStep?.proc?.stepDetail || "작업 내용이 없습니다."}</p>
              </div>
            </div>

            <div style={styles.scrollArea}>
              <div style={styles.recHeader}>
                <span style={styles.label}>추천 항목(DB) 및 수동 추가</span>
                <div style={styles.arrowBox}>
                  <button style={styles.arrowBtn} onClick={() => scroll('left')}>←</button>
                  <button style={styles.arrowBtn} onClick={() => scroll('right')}>→</button>
                </div>
              </div>

              <div style={styles.sliderContainer} ref={scrollRef}>
                <div style={styles.manualAddCard} onClick={() => addRisk({ type: 'manual' })}>
                  <div style={styles.plusIcon}>+</div>
                  <p style={styles.manualText}>새 위험요인<br />수동 작성</p>
                </div>

                {isLoading ? (
                  <>
                    <div style={styles.loadingCard}>DB 검색 중...</div>
                  </>
                ) : (
                  recommendations.map((rec, i) => (
                    <div key={i} style={styles.recommendCard} onClick={() => addRisk(rec)}>
                      <div style={styles.recBadge}>추천</div>
                      <p style={styles.recFactor}>{rec.factor}</p>
                      <p style={styles.recMeasure}>{rec.measure}</p>
                    </div>
                  ))
                )}

                {!isLoading && recommendations.length === 0 && (
                  <div style={styles.emptyCard}>추천 데이터 없음</div>
                )}
              </div>

              <div style={styles.riskControlRow}>
                <div style={styles.riskInputGroup}>
                  <span style={styles.label}>빈도(가능성)</span>
                  <select style={styles.select} value={currentStep.frequency} onChange={(e) => updateStepRisk('frequency', e.target.value)}>
                    {[1, 2, 3, 4, 5].map(n => <option key={n} value={n}>{n}</option>)}
                  </select>
                </div>
                <div style={styles.riskInputGroup}>
                  <span style={styles.label}>강도(중대성)</span>
                  <select style={styles.select} value={currentStep.severity} onChange={(e) => updateStepRisk('severity', e.target.value)}>
                    {[1, 2, 3, 4, 5].map(n => <option key={n} value={n}>{n}</option>)}
                  </select>
                </div>
                <div style={styles.riskResultGroup}>
                  <span style={styles.label}>위험도(R) [제안: {currentStep.frequency * currentStep.severity}]</span>
                  <select
                    style={{
                      ...styles.select,
                      fontWeight: 'bold',
                      color: currentStep.riskLevel >= 9 ? '#ff4d4d' : (currentStep.riskLevel >= 4 ? '#ffcc00' : '#007bff'),
                      border: `2px solid ${currentStep.riskLevel >= 9 ? '#ff4d4d' : (currentStep.riskLevel >= 4 ? '#ffcc00' : '#007bff')}`
                    }}
                    value={currentStep.riskLevel}
                    onChange={(e) => updateStepRisk('riskLevel', parseInt(e.target.value))}
                  >
                    {/* 1부터 25까지(5x5 매트릭스 기준) 모든 위험도 등급 선택 가능 */}
                    {Array.from({ length: 25 }, (_, i) => i + 1).map(n => (
                      <option key={n} value={n}>
                        {n} {n === (currentStep.frequency * currentStep.severity) ? "" : ""}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              <table style={styles.table}>
                <thead>
                  <tr>
                    <th style={{ ...styles.th, width: '40%' }}>선택된 유해·위험요인 (편집 가능)</th>
                    <th style={{ ...styles.th, width: '45%' }}>해당 작업 감소대책 (편집 가능)</th>
                    <th style={{ ...styles.th, width: '15%', textAlign: 'center' }}>관리</th>
                  </tr>
                </thead>
                <tbody>
                  {currentStep.risks.length === 0 ? (
                    <tr><td colSpan="3" style={styles.emptyTd}>위 카드를 클릭하여 위험요인을 추가하거나 수동으로 입력하세요.</td></tr>
                  ) : (
                    currentStep.risks.map((risk) => (
                      <tr key={risk.id}>
                        <td style={styles.td}>
                          <textarea style={styles.inlineInput} placeholder="유해·위험요인" value={risk.factor} onChange={(e) => updateRiskContent(risk.id, 'factor', e.target.value)} rows={2} />
                        </td>
                        <td style={styles.td}>
                          <textarea style={styles.inlineInput} placeholder="감소대책" value={risk.measure} onChange={(e) => updateRiskContent(risk.id, 'measure', e.target.value)} rows={2} />
                        </td>
                        <td style={{ ...styles.td, textAlign: 'center' }}>
                          <button style={styles.deleteBtn} onClick={() => deleteRisk(risk.id)}>삭제</button>
                        </td>
                      </tr>
                    ))
                  )}
                </tbody>
              </table>
            </div>

            <div style={styles.btnArea}>
              <button style={styles.prevBtn} onClick={handlePrev}>이전 단계</button>
              <button style={styles.nextBtn} onClick={handleNext}>
                {activeIdx === analysisData.length - 1 ? '작성 완료 및 출력' : '다음 작업 단계 분석'}
              </button>
            </div>

          </div>
        </main>

        <aside style={styles.sideAd}>
          <div style={styles.adPlaceholder}>AD Area 2</div>
        </aside>
      </div>

      <footer style={styles.footerArea}>
        <div style={styles.bottomAdWrapper}>
          <div style={styles.bottomAdPlaceholder}>AD Area 3 (Banner)</div>
        </div>
      </footer>
    </div>
  );
}

const styles = {
  wrapper: { position: 'relative', height: '100vh', width: '100%', overflow: 'hidden', display: 'flex', flexDirection: 'column', backgroundColor: '#000' },
  bgWrapper: { position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', zIndex: 0 },
  bgImage: { position: 'absolute', width: '100%', height: '100%', backgroundImage: 'url(/images/image3.jpg)', backgroundSize: 'cover', filter: 'brightness(0.3)' },
  dimOverlay: { position: 'absolute', width: '100%', height: '100%', background: 'rgba(0,0,0,0.5)', zIndex: 1 },
  header: { padding: '1.2rem 5rem', zIndex: 10, display: 'flex', alignItems: 'center' },
  logo: { fontSize: '1.4rem', fontWeight: '900', letterSpacing: '2px', textTransform: 'uppercase', color: '#fff', cursor: 'pointer', margin: 0 },
  mainLayout: { flex: 1, display: 'flex', alignItems: 'center', padding: '0 2rem', gap: '2rem', zIndex: 10, overflow: 'hidden', justifyContent: 'center' },
  sideAd: { flexShrink: 0, width: '150px', display: 'none' },
  centerContent: { flex: 1, display: 'flex', justifyContent: 'center', alignItems: 'center', maxWidth: '1400px', width: '100%' },
  adPlaceholder: { width: '100%', height: '600px', backgroundColor: 'rgba(255,255,255,0.05)', borderRadius: '8px', color: '#444', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.8rem' },
  bottomAdPlaceholder: { width: '728px', height: '90px', backgroundColor: 'rgba(255,255,255,0.05)', borderRadius: '4px', color: '#444', display: 'flex', alignItems: 'center', justifyContent: 'center' },
  formCard: { width: '100%', backgroundColor: 'rgba(18, 18, 18, 0.95)', border: '1px solid rgba(255, 255, 255, 0.15)', borderRadius: '12px', padding: '2rem 2.5rem', boxShadow: '0 40px 80px rgba(0,0,0,0.8)', maxHeight: '85vh', display: 'flex', flexDirection: 'column' },
  stepper: { display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '1.5rem', gap: '0.8rem' },
  stepItem: { display: 'flex', alignItems: 'center', gap: '0.6rem', opacity: 0.3 },
  stepItemActive: { display: 'flex', alignItems: 'center', gap: '0.6rem' },
  stepItemDone: { display: 'flex', alignItems: 'center', gap: '0.6rem' },
  stepBadge: { width: '22px', height: '22px', backgroundColor: '#333', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.75rem', fontWeight: 'bold', color: '#aaa' },
  stepBadgeActive: { width: '22px', height: '22px', backgroundColor: '#007bff', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.75rem', fontWeight: 'bold', color: '#fff', boxShadow: '0 0 10px rgba(0,123,255,0.6)' },
  stepBadgeDone: { width: '22px', height: '22px', backgroundColor: '#4caf50', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: '0.7rem' },
  stepText: { fontSize: '0.85rem', color: '#aaa' },
  stepTextActive: { fontSize: '0.85rem', color: '#fff', fontWeight: '700' },
  stepTextDone: { fontSize: '0.85rem', color: '#4caf50', fontWeight: '700' },
  stepLine: { width: '30px', height: '1px', backgroundColor: 'rgba(255,255,255,0.1)' },
  stepLineActive: { width: '30px', height: '1.5px', backgroundColor: '#4caf50' },
  formHeader: { marginBottom: '1.5rem', borderLeft: '5px solid #007bff', paddingLeft: '1rem' },
  formTitle: { fontSize: '1.4rem', fontWeight: '800', color: '#fff', marginBottom: '0.5rem' },
  stepContext: { display: 'flex', flexDirection: 'column', gap: '0.5rem' },
  stepTitleBadge: { display: 'inline-block', padding: '4px 10px', backgroundColor: 'rgba(0, 123, 255, 0.2)', color: '#4da3ff', fontSize: '0.8rem', fontWeight: 'bold', borderRadius: '4px', alignSelf: 'flex-start', border: '1px solid rgba(0, 123, 255, 0.3)' },
  stepDetailText: { fontSize: '1rem', color: '#ddd', lineHeight: '1.5' },
  scrollArea: { flex: 1, overflowY: 'auto', paddingRight: '10px', marginBottom: '1.5rem' },
  recHeader: { display: 'flex', justifyContent: 'space-between', marginBottom: '1rem', alignItems: 'center' },
  label: { fontSize: '0.85rem', color: '#888', fontWeight: '700' },
  arrowBox: { display: 'flex', gap: '0.5rem' },
  arrowBtn: { backgroundColor: '#333', border: '1px solid #555', color: '#fff', padding: '4px 10px', borderRadius: '4px', cursor: 'pointer', transition: 'background 0.2s' },
sliderContainer: { 
    display: 'flex', 
    gap: '1rem', 
    overflowX: 'auto',         // 기능은 유지하되
    paddingBottom: '0.8rem', 
    scrollBehavior: 'smooth', 
    marginBottom: '1.5rem',
    // 스크롤바 숨기기 (표준 및 브라우저별 설정)
    msOverflowStyle: 'none',   // IE, Edge
    scrollbarWidth: 'none',    // Firefox
    WebkitOverflowScrolling: 'touch', // iOS 가속 스크롤
  },  manualAddCard: { minWidth: '220px', width: '220px', height: '160px', backgroundColor: 'rgba(0, 123, 255, 0.05)', border: '2px dashed #007bff', borderRadius: '8px', cursor: 'pointer', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', transition: 'all 0.2s', flexShrink: 0 },
  plusIcon: { fontSize: '2.5rem', color: '#007bff', fontWeight: '300', marginBottom: '0.5rem' },
  manualText: { color: '#007bff', fontSize: '0.85rem', fontWeight: '700', textAlign: 'center', lineHeight: '1.4' },
  loadingCard: { minWidth: '240px', width: '240px', height: '160px', backgroundColor: '#111', border: '1px solid #333', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#007bff', fontSize: '0.9rem', flexShrink: 0, fontWeight: 'bold' },
  recommendCard: { minWidth: '240px', width: '240px', height: '160px', backgroundColor: '#1a1a1a', border: '1px solid #333', borderRadius: '8px', padding: '1.2rem', cursor: 'pointer', display: 'flex', flexDirection: 'column', justifyContent: 'space-between', transition: 'border-color 0.2s', flexShrink: 0, position: 'relative' },
  recBadge: { position: 'absolute', top: '10px', right: '10px', fontSize: '0.7rem', color: '#4caf50', border: '1px solid #4caf50', padding: '1px 5px', borderRadius: '3px' },
  recFactor: { color: '#fff', fontSize: '0.9rem', fontWeight: '700', lineHeight: '1.4', marginBottom: '0.5rem', paddingRight: '50px', wordBreak: 'keep-all' },
  recMeasure: { color: '#888', fontSize: '0.8rem', lineHeight: '1.4', overflow: 'hidden', textOverflow: 'ellipsis', display: '-webkit-box', WebkitLineClamp: 3, WebkitBoxOrient: 'vertical' },
  emptyCard: { minWidth: '240px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#555', fontSize: '0.9rem', border: '1px solid #333', borderRadius: '8px' },
  riskControlRow: { display: 'flex', gap: '2rem', alignItems: 'center', marginBottom: '1.5rem', padding: '1.2rem', backgroundColor: '#111', borderRadius: '8px', border: '1px solid #222' },
  riskInputGroup: { display: 'flex', flexDirection: 'column', gap: '0.5rem' },
  select: { backgroundColor: '#222', border: '1px solid #444', color: '#fff', padding: '0.5rem 1rem', borderRadius: '4px', outline: 'none', width: '80px', textAlign: 'center' },
  riskResultGroup: { display: 'flex', flexDirection: 'column', gap: '0.5rem', paddingLeft: '2rem', borderLeft: '1px solid #333', minWidth: '100px', alignItems: 'center' },
  riskDisplay: { fontSize: '2rem', fontWeight: '900', lineHeight: 1 },
  table: { width: '100%', borderCollapse: 'collapse', marginTop: '1rem' },
  th: { padding: '1rem', backgroundColor: '#151515', color: '#888', fontSize: '0.75rem', textAlign: 'left', borderBottom: '2px solid #333' },
  td: { padding: '0.8rem 0.5rem', borderBottom: '1px solid #222', color: '#fff', fontSize: '0.95rem', verticalAlign: 'top' },
  emptyTd: { padding: '3rem', textAlign: 'center', color: '#444', fontSize: '0.9rem' },
  inlineInput: { width: '100%', backgroundColor: 'transparent', border: '1px solid rgba(255,255,255,0.1)', color: '#fff', padding: '0.8rem', borderRadius: '4px', outline: 'none', fontSize: '0.9rem', resize: 'none', fontFamily: 'inherit', lineHeight: '1.5' },
  inlineInputFocus: { borderColor: '#007bff' },
  deleteBtn: { backgroundColor: 'rgba(255, 77, 77, 0.1)', color: '#ff4d4d', border: '1px solid rgba(255, 77, 77, 0.3)', padding: '6px 14px', borderRadius: '4px', cursor: 'pointer', fontSize: '0.8rem', fontWeight: 'bold' },
  btnArea: { marginTop: 'auto', paddingTop: '1.5rem', display: 'flex', gap: '1.2rem', borderTop: '1px solid rgba(255,255,255,0.1)' },
  prevBtn: { flex: 1, padding: '1.2rem', backgroundColor: 'transparent', color: '#aaa', border: '1px solid #444', borderRadius: '8px', cursor: 'pointer', fontWeight: '700', fontSize: '1rem', transition: 'all 0.2s' },
  nextBtn: { flex: 2, padding: '1.2rem', backgroundColor: '#fff', color: '#000', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '800', fontSize: '1.1rem', boxShadow: '0 4px 15px rgba(255,255,255,0.2)' },
  footerArea: { width: '100%', padding: '0.5rem 0 1.5rem', zIndex: 10 },
  bottomAdWrapper: { width: '100%', display: 'flex', justifyContent: 'center' },
};